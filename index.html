<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>FPS Game</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Add minimal critical styles here if needed before CSS loads */
        body { margin: 0; overflow: hidden; background-color: #111; }
        canvas#gameCanvas { display: block; } /* Avoid potential small gap */
    </style>
</head>
<body>

    <!-- The core rendering surface -->
    <canvas id="gameCanvas"></canvas>

    <!-- In-Game Heads-Up Display -->
    <div id="gameUI" style="display: none;">
        <!-- Top Left Stats -->
        <div class="hud-top-left">
            <div id="scoreDisplay">
                <span id="scoreLabel" data-i18n="score">SCORE</span>: <span id="scoreValue">0</span>
            </div>
             <div id="comboDisplay">
                <!-- Combo elements moved here for layout -->
                <div id="combo" class="combo-indicator" style="opacity: 0; transform: translateY(10px);">
                    <span id="comboValue">1.0x</span> <span id="comboHits">0 HIT</span>
                     <span id="comboLabel" class="combo-label">COMBO!</span> <!-- Optional Label -->
                </div>
            </div>
        </div>

        <!-- Top Right Stats -->
        <div class="hud-top-right">
            <div id="timerDisplay">
                <span id="timerLabel" data-i18n="time">TIME</span>: <span id="timerValue">90</span>
            </div>
        </div>

        <!-- Bottom Left Stats -->
        <div class="hud-bottom-left">
            <div id="healthDisplay" class="health-bar">
                <div id="healthFill" class="health-fill" style="width: 100%;"></div>
                <div id="healthValueDisplay"><span id="healthValue">100</span> HP</div>
            </div>
        </div>

        <!-- Bottom Right Stats -->
        <div class="hud-bottom-right">
             <div id="reloadIndicator" style="display: none;">
                 RELOADING <div class="reload-fill-container"><div class="reload-fill"></div></div>
             </div>
            <div id="ammoDisplay">
                <span id="ammoLabel" data-i18n="ammo">AMMO</span>:
                <span id="ammoValue">15</span> / <span id="ammoMaxValue">15</span>
                <span id="totalAmmoValue" class="total-ammo">(90)</span>
            </div>
        </div>

        <!-- Center Screen Elements -->
        <div id="hitMarker" style="opacity: 0;"></div> <!-- Styled as cross in CSS -->
        <div id="crosshair">
             <!-- Simple div crosshair, easier to style -->
             <div class="crosshair-line crosshair-line-h"></div>
             <div class="crosshair-line crosshair-line-v"></div>
        </div>
        <div id="gunEffects">
            <!-- Muzzle flash and other gun effects will be added here by JavaScript -->
        </div>
    </div>

    <!-- Settings Button (Separate from HUD for consistent positioning) -->
    <button class="settings-btn hidden" id="settingsButton"> <!-- Start hidden -->
         ⚙️ <span class="settings-btn-text">Settings</span>
    </button>

    <!-- Mobile Controls (Initially hidden, shown via CSS if .is-mobile) -->
    <div id="mobileControls" style="display: none;">
        <div id="joystick" class="mobile-control-area">
            <div id="joystickKnob"></div>
        </div>
        <div class="mobile-control-area shoot-area">
             <button id="shootButton">Shoot</button>
        </div>
    </div>

    <!-- === UI Screens (Overlays) === -->

    <!-- Start Screen UI -->
    <div id="startScreen" class="ui-screen show"> <!-- Initially Visible -->
        <div class="screen-content">
            <h1>FPS Training</h1>
            <p>Click or Tap Start</p>
            <button class="ui-button primary" id="startButton">Start Game</button>
        </div>
    </div>

    <!-- Pause Screen UI -->
    <div id="pauseScreen" class="ui-screen">
        <div class="screen-content">
            <h1>Game Paused</h1>
            <button class="ui-button primary" id="resumeButton">Resume</button>
            <button class="ui-button" onclick="Game.toggleSettings()">Settings</button> <!-- Direct call example -->
            <button class="ui-button" id="quitButton">Quit to Menu</button>
        </div>
    </div>

    <!-- Game Over Screen UI -->
    <div id="gameOverScreen" class="ui-screen">
         <div class="screen-content">
            <h1>Game Over</h1>
            <div class="game-over-stats">
                 <p>Final Score: <span id="finalScoreValue">0</span></p>
                 <p>Max Combo: <span id="maxComboValue">0</span> Hits</p>
            </div>
            <button class="ui-button primary" id="restartButton">Restart</button>
             <button class="ui-button" id="quitGameOverButton">Quit to Menu</button> <!-- Quit button for game over -->
         </div>
    </div>

    <!-- Settings Screen UI -->
    <div id="settingsScreen" class="ui-screen settings-panel">
        <div class="screen-content">
            <button id="closeSettingsButton" class="close-button">×</button>
            <h2>Settings</h2>

            <div class="settings-group">
                <h3>Language</h3>
                <div class="setting-row">
                    <label class="setting-label" for="languageSelect">Language:</label>
                    <div class="setting-control">
                        <select id="languageSelect">
                            <option value="en">English</option>
                            <option value="ko">Korean</option>
                            <!-- Add more languages -->
                        </select>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3>Controls</h3>
                 <p class="setting-note">(Click input box and press desired key)</p>
                <div class="setting-row">
                    <label class="setting-label" for="forwardKeyInput">Forward:</label>
                    <div class="setting-control">
                        <input type="text" id="forwardKeyInput" class="keybind-input" value="KeyW" readonly>
                    </div>
                </div>
                <div class="setting-row">
                    <label class="setting-label" for="backwardKeyInput">Backward:</label>
                    <div class="setting-control">
                        <input type="text" id="backwardKeyInput" class="keybind-input" value="KeyS" readonly>
                    </div>
                </div>
                <div class="setting-row">
                    <label class="setting-label" for="leftKeyInput">Left:</label>
                    <div class="setting-control">
                        <input type="text" id="leftKeyInput" class="keybind-input" value="KeyA" readonly>
                    </div>
                </div>
                <div class="setting-row">
                    <label class="setting-label" for="rightKeyInput">Right:</label>
                    <div class="setting-control">
                        <input type="text" id="rightKeyInput" class="keybind-input" value="KeyD" readonly>
                    </div>
                </div>
                 <div class="setting-row">
                    <label class="setting-label" for="touchSensitivity">Touch Sensitivity:</label>
                    <div class="setting-control">
                        <input type="range" id="touchSensitivity" min="0.1" max="3.0" step="0.1" value="1.0">
                        <span id="touchSensitivityValue" class="setting-value-display">1.0</span>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3>Audio</h3>
                <div class="setting-row">
                    <label class="setting-label" for="musicVolume">Music Volume:</label>
                    <div class="setting-control">
                        <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5">
                        <span id="musicVolumeValue" class="setting-value-display">50</span>%
                    </div>
                </div>
                <div class="setting-row">
                    <label class="setting-label" for="sfxVolume">SFX Volume:</label>
                    <div class="setting-control">
                        <input type="range" id="sfxVolume" min="0" max="1" step="0.01" value="0.7">
                        <span id="sfxVolumeValue" class="setting-value-display">70</span>%
                    </div>
                </div>
                 <div class="setting-row checkbox-row">
                     <div class="setting-control">
                         <input type="checkbox" id="spatialReverb" checked>
                     </div>
                    <label class="setting-label checkbox-label" for="spatialReverb">Use Spatial Reverb</label>
                </div>
                <div class="setting-row">
                    <label class="setting-label" for="reverbQuality">Reverb Quality:</label>
                    <div class="setting-control">
                        <select id="reverbQuality" disabled> <!-- Initially disabled, enabled by JS -->
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Add more settings groups as needed -->
            <p class="setting-note">Settings are saved automatically.</p>
        </div>
    </div>

    <!-- External Libraries -->
    <!-- Use specific versions or download locally for production -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Make sure cannon-es version is compatible or update JS accordingly if needed -->
    <script src="https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"></script>

    <!-- Your Game Logic -->
    <script src="script.js"></script>

    <!-- Initiator Script (optional, keeps Game init out of global scope) -->
    <script>
        // Ensure the DOM is fully loaded before initializing
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Loaded, Initializing Game...");
            // Initialize the game. It will show the start screen via resetGame().
            Game.init().catch(error => {
                 console.error("Game initialization failed:", error);
                 // Optionally display a user-friendly message on the page
                 document.body.innerHTML = `<div style="color: white; padding: 30px; text-align: center;"><h1>Error</h1><p>Could not initialize the game.</p><p>${error.message}</p>Please check console for details.</div>`;
             });

             // Add listener for the other quit button
             const quitGameOverButton = document.getElementById('quitGameOverButton');
             if(quitGameOverButton) {
                 quitGameOverButton.addEventListener('click', () => {
                    window.location.reload(); // Or Game.resetGame() if you want to return to start screen
                 });
             }
        });
    </script>

</body>
</html>
